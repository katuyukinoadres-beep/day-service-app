# テスト仕様書

## プロジェクト名
**ぱっと記録（Patto Kiroku）**

**最終更新日**: 2026-02-22

---

## 1. テスト方針

### 1.1 テスト戦略
本プロジェクトでは以下のテストレベルを段階的に実施する。

| テストレベル | 目的 | ツール |
|---|---|---|
| ビルドテスト | TypeScript型チェック・ビルド成功確認 | `next build` |
| リントテスト | コード品質・一貫性の検証 | ESLint 9 |
| E2Eテスト（手動） | ユーザー操作シナリオの検証 | ブラウザ |
| 手動テスト | UI/UX、印刷、レスポンシブ確認 | ブラウザ |

### 1.2 テスト優先度
- **P1（必須）**: 認証、データ登録・更新・削除、帳票出力、ロール制御
- **P2（重要）**: 画面遷移、バリデーション、フィルタ、AI機能
- **P3（推奨）**: UI表示、レスポンシブ、パフォーマンス

### 1.3 テスト対象アプリ
- **メインアプリ（apps/main）**: スタッフ向け記録アプリ（localhost:3000）
- **管理アプリ（apps/admin）**: 管理者向けダッシュボード（localhost:3001）

---

## 2. メインアプリ テストケース

### 2.1 認証 (AUTH)

| ID | テスト項目 | 操作手順 | 期待結果 | 優先度 |
|---|---|---|---|---|
| AUTH-001 | 新規登録（正常） | ログイン画面で「アカウント作成」タブ → 施設名・表示名・メール・パスワード（6文字以上）を入力 →「登録する」タップ | 施設がfacilitiesテーブルに作成、profilesにadminロールで登録、ホーム画面に遷移 | P1 |
| AUTH-002 | 新規登録（メール重複） | 既に登録済みのメールアドレスで登録を試行 | エラーメッセージが表示され、登録されない | P1 |
| AUTH-003 | 新規登録（パスワード短い） | パスワード5文字以下で登録を試行 | 「パスワードは6文字以上で入力してください」エラー表示 | P2 |
| AUTH-004 | 新規登録（必須項目空） | 施設名または表示名を空で登録を試行 | バリデーションエラーが表示される | P2 |
| AUTH-005 | ログイン（正常） | 「ログイン」タブ → 正しいメール・パスワードを入力 →「ログイン」タップ | ホーム画面（/）に遷移 | P1 |
| AUTH-006 | ログイン（認証失敗） | 誤ったパスワードでログインを試行 | エラーメッセージが表示される | P1 |
| AUTH-007 | ログアウト | 設定画面 →「ログアウト」タップ | ログイン画面に遷移、セッション無効化 | P1 |
| AUTH-008 | スタッフ招待参加 | `/join?facility={facilityId}` にアクセス → 表示名・メール・パスワードを入力して登録 | staffロールで同一施設のprofilesに登録、ホームに遷移 | P1 |
| AUTH-009 | 未認証アクセス | ログインせずに `/` にアクセス | `/login` にリダイレクト | P1 |
| AUTH-010 | ログイン中のloginアクセス | ログイン状態で `/login` にアクセス | `/` にリダイレクト | P2 |

---

### 2.2 ホーム画面 (HOME)

| ID | テスト項目 | 操作手順 | 期待結果 | 優先度 |
|---|---|---|---|---|
| HOME-001 | 日付表示 | ホーム画面を表示 | 今日の日付（YYYY年M月D日(曜日)）が表示される | P2 |
| HOME-002 | 未記録児童セクション | 記録がない児童がいる状態で表示 | 「未記録」セクションに児童がリスト表示、タップで記録画面に遷移 | P1 |
| HOME-003 | 記録済みセクション | 記録済み児童がいる状態で表示 | 「記録済み」セクションに児童名と気分アイコンが表示、タップで編集画面に遷移 | P1 |
| HOME-004 | 進捗バー | 児童5名中3名記録済み | 「3/5 記録済み」と60%進捗バー表示 | P2 |
| HOME-005 | 児童なし | 児童が登録されていない施設でログイン | 「児童が登録されていません」メッセージ表示 | P2 |
| HOME-006 | 全員記録済み | 全児童の記録が完了 | 完了メッセージ表示、進捗バー100% | P2 |

---

### 2.3 児童管理 (CHILD)

| ID | テスト項目 | 操作手順 | 期待結果 | 優先度 |
|---|---|---|---|---|
| CHILD-001 | 児童一覧表示 | BottomNavの「児童」をタップ | 有効な(is_active=true)児童がアイコン色付きで一覧表示 | P1 |
| CHILD-002 | 児童新規登録（正常） | 「＋ 児童を追加」→ 名前を入力して「保存する」 | 児童がchildrenテーブルに登録、一覧に表示 | P1 |
| CHILD-003 | 児童登録（名前なし） | 名前を空で「保存する」タップ | 保存されない（バリデーション） | P2 |
| CHILD-004 | 児童登録（全項目入力） | 名前・ふりがな・生年月日・学校・学年・アイコン色・支援領域・目標を全て入力して保存 | 全項目が保存される | P1 |
| CHILD-005 | 児童編集 | 児童一覧 → 児童をタップ → 情報を変更して「保存する」 | 変更が反映される | P1 |
| CHILD-006 | 児童削除（無効化） | 児童編集画面 →「この児童を削除する」→ 確認ダイアログで「削除する」 | is_active=falseに更新、一覧から非表示 | P1 |
| CHILD-007 | アイコン色選択 | 8色のカラーピッカーから色を選択して保存 | 選択した色(icon_color)でアバターが表示される | P3 |
| CHILD-008 | 支援領域タグ（複数選択） | 5つの支援領域タグから複数選択して保存 | domain_tagsに保存、記録画面でフレーズ優先表示に反映 | P2 |
| CHILD-009 | 個別目標の追加・削除 | 「目標を追加」で入力 → 追加・不要な目標を「×」で削除して保存 | goals配列に反映、帳票に表示 | P2 |
| CHILD-010 | 学年選択 | 学年ドロップダウンから選択して保存 | 選択した学年が保存される | P3 |

---

### 2.4 日次記録 (REC)

| ID | テスト項目 | 操作手順 | 期待結果 | 優先度 |
|---|---|---|---|---|
| REC-001 | 新規記録作成（最小入力） | ホームで未記録児童をタップ → 何も入力せず「保存して次へ」 | 記録がdaily_recordsに保存、ホームで「記録済み」に移動 | P1 |
| REC-002 | 新規記録作成（全項目入力） | 来所・退所時刻、気分、活動、フレーズ、メモ、AI下書き、送迎方法を全て入力して保存 | 全項目が正しく保存される | P1 |
| REC-003 | 来所時刻の初期値 | 未記録児童の記録画面を開く | 現在時刻（HH:MM形式）が来所時刻にプリセットされる | P2 |
| REC-004 | 気分選択（単一選択） | 3つの気分ボタン（😊/😐/😢）から1つを選択 | 選択した気分がハイライト、再度別の気分をタップで切替 | P2 |
| REC-005 | 気分選択解除 | 選択済みの気分ボタンを再タップ | 気分選択が解除（nullに戻る） | P2 |
| REC-006 | 活動チップ複数選択 | 複数の活動チップ（工作、運動、学習等）をタップ | 複数選択可能、再タップで解除 | P1 |
| REC-007 | 活動種類の確認 | 記録画面の活動セクション確認 | 工作、運動、学習、自由遊び、SST、おやつ、外出、音楽、調理の9種類が表示 | P3 |
| REC-008 | フレーズ選択 | フレーズをタップ | チェックマーク付きでハイライト表示、phrases配列に追加 | P1 |
| REC-009 | フレーズ優先表示 | 支援領域タグが設定された児童の記録画面を開く | 該当タグのフレーズが上位に表示、黄色ハイライト | P2 |
| REC-010 | 既存記録の編集 | ホームの記録済み児童をタップ | 既存データが復元され「編集中」バッジ表示、ボタン「更新する」に変更 | P1 |
| REC-011 | 自動遷移（次の児童） | 未記録児童が残っている状態で保存 | 次の未記録児童の記録画面に自動遷移 | P1 |
| REC-012 | 自動遷移（全員完了） | 最後の未記録児童の記録を保存 | ホーム画面に遷移 | P1 |
| REC-013 | 送迎方法（単一選択） | 送迎方法チップ（送迎車/保護者/自力/その他）をタップ | 1つのみ選択可能、再タップで解除 | P2 |
| REC-014 | メモ入力 | テキストエリアに自由記述して保存 | 入力したメモがmemoフィールドに保存される | P2 |
| REC-015 | AI支援記録まとめ生成 | 各項目を入力後「AIで下書き作成」タップ | `/api/generate-record`にPOST、支援記録まとめ欄にAI生成文が挿入 | P1 |
| REC-015b | AIバージョンラベル表示 | 記録入力画面を表示 | 「AIで下書き作成」ボタンに「v2.0」ラベルが表示される | P3 |
| REC-016 | AI生成中のローディング | AI生成ボタンをタップ | ローディング表示、完了まで再タップ不可 | P2 |
| REC-017 | AI生成エラー | APIキー未設定またはネットワーク切断時にAI生成 | エラーメッセージがアラート表示される | P2 |
| REC-018 | 支援記録まとめ手入力 | AI未使用でテキストエリアに直接入力して保存 | ai_textフィールドに保存される | P2 |
| REC-019 | recorded_by記録 | 記録を保存 | recorded_byにログインユーザーのIDが記録される | P1 |

---

### 2.5 記録履歴 (HIST)

| ID | テスト項目 | 操作手順 | 期待結果 | 優先度 |
|---|---|---|---|---|
| HIST-001 | 履歴一覧表示 | BottomNavの「履歴」タップ | 記録が新しい順で一覧表示 | P1 |
| HIST-002 | 日付フィルタ | 日付ピッカーで特定日を選択 | 選択日の記録のみ表示 | P2 |
| HIST-003 | 児童フィルタ | 児童セレクトで特定児童を選択 | 選択児童の記録のみ表示 | P2 |
| HIST-004 | 日付＋児童フィルタ併用 | 日付と児童の両方を指定 | 両条件を満たす記録のみ表示 | P2 |
| HIST-005 | 記録詳細表示 | 一覧の記録カードを確認 | 気分、活動、フレーズ、メモ、支援記録まとめ、送迎方法が表示される | P1 |
| HIST-006 | 記録編集 | 記録カードの「編集」ボタンタップ | `/record/[childId]` に遷移、既存データが復元される | P1 |
| HIST-007 | 記録削除 | 記録カードの「削除」ボタン → 確認ダイアログで「削除する」 | daily_recordsから削除、一覧から消える | P1 |
| HIST-008 | 記録削除キャンセル | 確認ダイアログで「キャンセル」 | 記録が削除されない | P2 |
| HIST-009 | 記録なし状態 | 記録が存在しないフィルタ条件を指定 | 「記録がありません」メッセージ表示 | P2 |

---

### 2.6 帳票出力 (DOC)

| ID | テスト項目 | 操作手順 | 期待結果 | 優先度 |
|---|---|---|---|---|
| DOC-001 | 帳票メニュー表示 | BottomNavの「帳票」タップ | 業務日誌・サービス提供記録・月間出席集計の3つのメニュー表示 | P2 |
| DOC-002 | 業務日誌表示 | 業務日誌 → 日付選択 | 当日の全記録が表形式で表示（児童名、来所、退所、活動、支援記録まとめ、送迎） | P1 |
| DOC-003 | 業務日誌印刷 | 「印刷 / PDF」ボタンタップ | ブラウザの印刷ダイアログ起動、A4縦で適切なレイアウト | P1 |
| DOC-004 | 業務日誌ヘッダー | 業務日誌を表示 | 施設名・日付・管理者/確認者の署名欄が表示される | P1 |
| DOC-005 | 業務日誌（記録なし） | 記録のない日を選択 | 「この日の記録はありません」メッセージ表示 | P2 |
| DOC-006 | サービス提供記録表示 | サービス提供記録 → 日付と児童を選択 | 個別の支援記録が帳票形式で表示 | P1 |
| DOC-007 | サービス提供記録（児童情報） | サービス提供記録を表示 | 児童の基本情報（名前、生年月日、学校・学年、支援領域、目標）が表示 | P1 |
| DOC-008 | サービス提供記録（記録内容） | サービス提供記録を表示 | 来所退所時刻、気分、活動、フレーズ、メモ、支援記録まとめ、送迎方法、記録者名が表示 | P1 |
| DOC-009 | サービス提供記録印刷 | 「印刷 / PDF」ボタンタップ | A4縦で適切なレイアウト、署名欄付き | P1 |
| DOC-010 | 月間出席サマリー表示 | 月間出席集計 → 月を選択 | 児童×日のグリッドで出席(○)が表示 | P1 |
| DOC-011 | 月間出席サマリー集計 | 月間出席集計を表示 | 児童ごとの出席日数合計、日ごとの利用人数が表示される | P1 |
| DOC-012 | 月間出席サマリー週末 | 月間出席集計を表示 | 土日セルが色分けされる | P3 |
| DOC-013 | 月間出席サマリー印刷 | 「印刷 / PDF」ボタンタップ | A4横で適切なレイアウト | P1 |

---

### 2.7 フレーズ管理 (PHR)

| ID | テスト項目 | 操作手順 | 期待結果 | 優先度 |
|---|---|---|---|---|
| PHR-001 | フレーズ一覧表示 | 設定 →「フレーズ管理」 | カテゴリ（支援領域）別にフレーズが表示される | P2 |
| PHR-002 | デフォルトフレーズ表示 | フレーズ一覧確認 | 「デフォルト」バッジ付き、タップしても編集画面に遷移しない | P2 |
| PHR-003 | カスタムフレーズ追加 | 「＋ フレーズを追加」→ カテゴリ・テキスト・支援領域タグを入力して保存 | phrase_bankに登録（is_default=false, facility_id=自施設） | P2 |
| PHR-004 | カスタムフレーズ編集 | カスタムフレーズをタップ → 内容を変更して保存 | 変更がphrase_bankに反映 | P2 |
| PHR-005 | カスタムフレーズ削除 | カスタムフレーズ編集画面 →「削除」 | phrase_bankから削除される | P2 |

---

### 2.8 設定・ロール制御 (SET)

| ID | テスト項目 | 操作手順 | 期待結果 | 優先度 |
|---|---|---|---|---|
| SET-001 | 設定メニュー表示（admin） | adminロールで設定画面を表示 | プロフィール、フレーズ管理、スタッフ管理、施設設定の全メニュー表示 | P2 |
| SET-002 | 設定メニュー表示（staff） | staffロールで設定画面を表示 | プロフィール、フレーズ管理のみ表示、スタッフ管理・施設設定は非表示 | P1 |
| SET-003 | プロフィール表示名変更 | 表示名を変更して「保存する」 | display_nameが更新される | P2 |
| SET-004 | プロフィール（メール表示） | プロフィール画面を表示 | メールアドレスが読み取り専用で表示 | P3 |
| SET-005 | プロフィール（ロール表示） | プロフィール画面を表示 | ロール（管理者/スタッフ）が読み取り専用で表示 | P3 |
| SET-006 | 施設名変更（admin） | 施設設定 → 施設名変更して保存 | facilitiesテーブルのnameが更新される | P2 |
| SET-007 | スタッフ一覧表示（admin） | スタッフ管理画面を表示 | 同一施設のスタッフ一覧（表示名・ロール）が表示 | P2 |
| SET-008 | ロール変更（admin → staff） | 他スタッフのロール変更ボタンタップ | admin ↔ staff が切り替わる | P2 |
| SET-009 | 自身のロール変更不可 | 自分自身のロール変更を試行 | （自分）バッジ表示、変更ボタンが無効化 | P2 |
| SET-010 | 招待リンク生成 | スタッフ管理 →「スタッフを招待」 | `/join?facility={facilityId}` 形式のURLが表示される | P2 |
| SET-011 | 招待リンクコピー | 「コピー」ボタンタップ | クリップボードにURLがコピー、コピー完了表示 | P3 |

---

## 3. 管理アプリ テストケース

### 3.1 管理者認証 (ADMIN-AUTH)

| ID | テスト項目 | 操作手順 | 期待結果 | 優先度 |
|---|---|---|---|---|
| AAUTH-001 | 管理者ログイン（正常） | `/login` → 正しいパスワード（ADMIN_PASSWORD環境変数と一致）入力 →「ログイン」 | admin_sessionクッキーが設定(24h有効)、ダッシュボードに遷移 | P1 |
| AAUTH-002 | 管理者ログイン（パスワード誤り） | 誤ったパスワードでログインを試行 | 「パスワードが正しくありません」エラー表示 | P1 |
| AAUTH-003 | 未認証アクセス | ログインせずにダッシュボードにアクセス | `/login` にリダイレクト | P1 |
| AAUTH-004 | ログアウト | サイドバーの「ログアウト」タップ | admin_sessionクッキー削除、ログイン画面に遷移 | P1 |
| AAUTH-005 | セッション期限切れ | 24時間後にアクセス | ログイン画面にリダイレクト | P2 |

---

### 3.2 ダッシュボード (ADMIN-DASH)

| ID | テスト項目 | 操作手順 | 期待結果 | 優先度 |
|---|---|---|---|---|
| ADASH-001 | 統計カード表示 | ダッシュボード表示 | 施設数、ユーザー数、総記録数、本日の記録数、本日アクティブ施設数の5つの統計カードが表示 | P1 |
| ADASH-002 | 最近の記録表示 | ダッシュボード表示 | 直近10件の記録が日付・気分・活動・作成日時と共に表示 | P2 |
| ADASH-003 | 統計値の正確性 | Supabaseの実データと比較 | get_admin_stats()の結果と一致 | P1 |

---

### 3.3 施設管理 (ADMIN-FAC)

| ID | テスト項目 | 操作手順 | 期待結果 | 優先度 |
|---|---|---|---|---|
| AFAC-001 | 施設一覧表示 | サイドバー「施設管理」タップ | 全施設がリスト表示（名前、スタッフ数、ステータスバッジ、作成日） | P1 |
| AFAC-002 | 施設検索 | 検索ボックスに施設名を入力 | 名前に一致する施設のみ表示 | P2 |
| AFAC-003 | 施設新規作成 | 「＋ 新規施設」→ 施設名・プラン・備考を入力して「作成」 | facilitiesテーブルに登録、一覧に表示 | P1 |
| AFAC-004 | 施設詳細表示 | 施設をクリック | 施設情報（名前、ステータス、プラン、備考、作成日）とスタッフ数・記録数が表示 | P1 |
| AFAC-005 | 施設情報編集 | 施設詳細 →「編集」→ 情報変更して保存 | 施設名、プラン（free/basic/pro）、備考、有効フラグが更新される | P1 |
| AFAC-006 | 施設無効化 | 施設編集 → is_activeをOFF → 保存 | ステータスバッジが「無効」に変更 | P1 |
| AFAC-007 | 施設の記録一覧 | 施設詳細 →「記録」タブ | 当該施設の直近記録が日付順で表示 | P2 |
| AFAC-008 | 施設の記録日付フィルタ | 記録タブで日付を選択 | 選択日の記録のみ表示 | P2 |
| AFAC-009 | 施設のスタッフ一覧 | 施設詳細 →「スタッフ」タブ | 当該施設のスタッフ（表示名・ロール・作成日）が表示 | P2 |
| AFAC-010 | 施設スタッフのロール変更 | スタッフのロール変更ボタンクリック | admin ↔ staff が切り替わる | P2 |
| AFAC-011 | 施設の児童一覧 | 施設詳細 →「児童」タブ | 当該施設の児童（名前、ふりがな、学校、学年、ステータス）が表示 | P2 |
| AFAC-012 | 施設の児童フィルタ | 児童タブでフィルタ（全て/有効/無効）選択 | 選択したステータスの児童のみ表示 | P2 |

---

### 3.4 ユーザー管理 (ADMIN-USER)

| ID | テスト項目 | 操作手順 | 期待結果 | 優先度 |
|---|---|---|---|---|
| AUSER-001 | ユーザー一覧表示 | サイドバー「ユーザー管理」タップ | 全ユーザーが表示名・施設名・ロール・スーパー管理者バッジ・作成日と共にリスト表示 | P1 |
| AUSER-002 | ユーザー検索 | 検索ボックスに名前または施設名を入力 | 一致するユーザーのみ表示 | P2 |
| AUSER-003 | ユーザー詳細表示 | ユーザーをクリック | プロフィール詳細（表示名、施設、ロール、スーパー管理者、作成日、ユーザーID）表示 | P1 |
| AUSER-004 | ユーザーロール変更 | ユーザー詳細 →「ロール変更」ボタン | admin ↔ staff が切り替わる | P2 |
| AUSER-005 | スーパー管理者切替 | ユーザー詳細 →「スーパー管理者」トグル | is_super_adminの切替 | P2 |

---

### 3.5 管理アプリ レイアウト (ADMIN-UI)

| ID | テスト項目 | 操作手順 | 期待結果 | 優先度 |
|---|---|---|---|---|
| AUI-001 | サイドバー表示（デスクトップ） | デスクトップ幅でダッシュボード表示 | 固定サイドバーにロゴ・ナビ項目（ダッシュボード、施設管理、ユーザー管理、レポート）・ログアウト表示 | P2 |
| AUI-002 | モバイルメニュー | モバイル幅で表示 → ハンバーガーメニュータップ | サイドバーがオーバーレイで表示 | P2 |
| AUI-003 | アクティブナビ表示 | 各ページに遷移 | 現在のページに対応するナビ項目がハイライトされる | P3 |

---

## 4. API テストケース

### 4.1 AI記録生成API (API-AI)

| ID | テスト項目 | リクエスト | 期待結果 | 優先度 |
|---|---|---|---|---|
| API-AI-001 | 正常な記録生成 | POST `/api/generate-record` に childName, mood, activities, phrases等を送信 | 200レスポンス、`{ text: "..." }` でです・ます調の3-5文の支援記録返却 | P1 |
| API-AI-002 | 最小データでの生成 | childNameのみ送信 | 200レスポンス、名前のみで生成されたテキスト返却 | P2 |
| API-AI-003 | APIキー未設定 | ANTHROPIC_API_KEY未設定で呼び出し | 500エラー、エラーメッセージ返却 | P2 |

### 4.2 スタッフ招待API (API-INV)

| ID | テスト項目 | リクエスト | 期待結果 | 優先度 |
|---|---|---|---|---|
| API-INV-001 | 招待実行（admin） | POST `/api/admin/invite` に email, displayName, role送信 | 200レスポンス、`{ success: true }` | P1 |
| API-INV-002 | 招待実行（staff権限で） | staffロールユーザーで招待API呼び出し | 403エラー（権限不足） | P1 |

### 4.3 管理データAPI (API-ADMIN)

| ID | テスト項目 | リクエスト | 期待結果 | 優先度 |
|---|---|---|---|---|
| API-ADM-001 | 統計取得 | GET `/api/admin-data?type=stats` | 5つの統計値が含まれるJSON返却 | P1 |
| API-ADM-002 | セッションなしアクセス | admin_sessionクッキーなしでAPIアクセス | 401エラー返却 | P1 |
| API-ADM-003 | 施設作成 | POST `/api/admin-data?type=create-facility` | 施設が作成される | P1 |
| API-ADM-004 | 施設更新 | POST `/api/admin-data?type=update-facility` | 施設情報が更新される | P1 |

---

## 5. マルチテナント分離テスト

| ID | テスト項目 | 操作手順 | 期待結果 | 優先度 |
|---|---|---|---|---|
| MT-001 | 施設間データ分離（児童） | 施設Aのユーザーでログインし児童一覧を表示 | 施設Aの児童のみ表示（施設Bのデータは非表示） | P1 |
| MT-002 | 施設間データ分離（記録） | 施設Aのユーザーで記録履歴を表示 | 施設Aの記録のみ表示 | P1 |
| MT-003 | 施設間データ分離（フレーズ） | 施設Aのユーザーでフレーズ一覧を表示 | 施設Aのカスタムフレーズ＋デフォルトフレーズのみ表示 | P1 |
| MT-004 | 他施設データ直接アクセス | Supabase APIで他施設のchild_idを指定してクエリ | RLSにより空結果が返却 | P1 |
| MT-005 | 他施設記録への書き込み | 他施設のchild_idでdaily_recordsにINSERT試行 | RLSによりエラー | P1 |

---

## 6. レスポンシブ・UIテスト

| ID | テスト項目 | 対象端末 | 確認事項 | 優先度 |
|---|---|---|---|---|
| UI-001 | iPhone SE表示 | 375×667px | レイアウト崩れなし、タップターゲット44px以上、BottomNav正常 | P2 |
| UI-002 | iPhone 14表示 | 390×844px | レイアウト崩れなし、セーフエリア対応 | P2 |
| UI-003 | iPad表示 | 768×1024px | 基本的なレイアウト維持 | P3 |
| UI-004 | デスクトップ表示 | 1440×900px | メインアプリ・管理アプリ共に表示崩れなし | P3 |
| UI-005 | 印刷プレビュー（業務日誌） | 全ブラウザ | A4縦に適切に収まる、.no-printクラス要素が非表示 | P1 |
| UI-006 | 印刷プレビュー（サービス提供記録） | 全ブラウザ | A4縦に適切に収まる、署名欄が印刷される | P1 |
| UI-007 | 印刷プレビュー（月間出席） | 全ブラウザ | A4横に適切に収まる | P1 |
| UI-008 | BottomNav固定表示 | モバイル全ページ | 画面下部に常時固定、スクロールに追従しない | P2 |

---

## 7. パフォーマンステスト

| ID | テスト項目 | 計測方法 | 目標値 | 優先度 |
|---|---|---|---|---|
| PERF-001 | 初期ロード時間 | Lighthouse | FCP < 2秒 | P2 |
| PERF-002 | ホーム画面データ読み込み | DevTools Network | < 1秒 | P2 |
| PERF-003 | 記録保存レスポンス | DevTools Network | < 500ms | P2 |
| PERF-004 | AI生成レスポンス | DevTools Network | < 10秒 | P2 |
| PERF-005 | 画面遷移速度 | 体感計測 | < 300ms | P3 |

---

## 8. セキュリティテスト

| ID | テスト項目 | 確認方法 | 期待結果 | 優先度 |
|---|---|---|---|---|
| SEC-001 | 認証なしSupabase APIアクセス | 認証トークンなしでSupabase REST APIを呼び出し | 401エラーまたは空結果 | P1 |
| SEC-002 | RLS有効性 | 他施設ユーザーのトークンでデータ取得試行 | 空結果 | P1 |
| SEC-003 | XSS防止（メモ欄） | メモ欄に `<script>alert('xss')</script>` を入力して保存・表示 | HTMLエスケープされてテキストとして表示 | P1 |
| SEC-004 | XSS防止（児童名） | 児童名に `<img onerror=alert(1)>` を入力して保存・表示 | HTMLエスケープされてテキストとして表示 | P1 |
| SEC-005 | HTTPS通信 | ブラウザ開発者ツールでNetwork確認 | すべての通信がHTTPS（本番環境） | P1 |
| SEC-006 | 環境変数の非公開 | ブラウザソースコードを確認 | `SUPABASE_SERVICE_ROLE_KEY`、`ANTHROPIC_API_KEY`、`ADMIN_PASSWORD`が露出していない | P1 |
| SEC-007 | 管理APIセッション検証 | admin_sessionクッキーを偽造してAPI呼び出し | 認証エラー返却 | P1 |

---

## 9. テスト環境

| 項目 | 内容 |
|---|---|
| テスト用Supabaseプロジェクト | 本番とは別のプロジェクトを使用 |
| テストデータ | シードスクリプトで初期データ投入 |
| ブラウザ | Chrome（最新）、Safari（最新） |
| デバイス | iPhone実機 or Chrome DevToolsエミュレーション |
| メインアプリURL | http://localhost:3000 |
| 管理アプリURL | http://localhost:3001 |

---

## 10. テストケースサマリー

| カテゴリ | テストケース数 | P1 | P2 | P3 |
|---|---|---|---|---|
| 認証 (AUTH) | 10 | 7 | 3 | 0 |
| ホーム (HOME) | 6 | 2 | 4 | 0 |
| 児童管理 (CHILD) | 10 | 4 | 3 | 3 |
| 日次記録 (REC) | 19 | 8 | 11 | 0 |
| 記録履歴 (HIST) | 9 | 4 | 5 | 0 |
| 帳票出力 (DOC) | 13 | 8 | 2 | 3 |
| フレーズ管理 (PHR) | 5 | 0 | 5 | 0 |
| 設定・ロール (SET) | 11 | 1 | 7 | 3 |
| 管理者認証 (AAUTH) | 5 | 4 | 1 | 0 |
| ダッシュボード (ADASH) | 3 | 2 | 1 | 0 |
| 施設管理 (AFAC) | 12 | 4 | 8 | 0 |
| ユーザー管理 (AUSER) | 5 | 2 | 3 | 0 |
| 管理UI (AUI) | 3 | 0 | 2 | 1 |
| API (API) | 7 | 5 | 2 | 0 |
| マルチテナント (MT) | 5 | 5 | 0 | 0 |
| レスポンシブ (UI) | 8 | 3 | 3 | 2 |
| パフォーマンス (PERF) | 5 | 0 | 4 | 1 |
| セキュリティ (SEC) | 7 | 7 | 0 | 0 |
| **合計** | **143** | **66** | **64** | **13** |
