# 要件定義書

## プロジェクト名
**ぱっと記録（Patto Kiroku）** — 放課後等デイサービス 支援記録管理システム

---

## 1. プロジェクト概要

### 1.1 背景
放課後等デイサービス事業所では、日々の児童の支援記録を紙ベースで管理している施設が多く、記録作業に多大な時間を要している。記録の漏れや転記ミス、帳票作成の手間が現場のスタッフの負担となっている。

### 1.2 目的
本システムは、放課後等デイサービスにおける日々の支援記録をデジタル化し、スタッフの記録業務を効率化するWebアプリケーションである。スマートフォンからの操作を前提としたモバイルファーストの設計により、現場での即時記録を可能にする。

### 1.3 対象ユーザー
| ユーザー種別 | 説明 |
|---|---|
| 管理者（admin） | 施設責任者。施設設定・スタッフ管理・全機能の利用が可能 |
| スタッフ（staff） | 支援員。日常の記録入力・閲覧・帳票出力が可能 |
| スーパー管理者 | システム全体の管理者。Admin管理画面から全施設の管理が可能 |

---

## 2. 機能要件

### 2.1 認証・ユーザー管理

| ID | 機能 | 説明 | 対象ロール |
|---|---|---|---|
| AUTH-001 | 新規登録（施設作成） | メールアドレス・パスワードで新規登録。施設も同時に作成し、管理者ロールが付与される | - |
| AUTH-002 | ログイン | メールアドレス・パスワードでログイン | 全ユーザー |
| AUTH-003 | ログアウト | セッションを終了しログイン画面へ遷移 | 全ユーザー |
| AUTH-004 | スタッフ招待 | 招待リンクを生成し、新規スタッフを施設に紐付けて登録 | admin |
| AUTH-005 | ロール変更 | スタッフのロール（admin/staff）を切り替え | admin |

### 2.2 児童管理

| ID | 機能 | 説明 | 対象ロール |
|---|---|---|---|
| CHILD-001 | 児童一覧表示 | 施設に登録された有効な児童を五十音順で一覧表示 | 全ユーザー |
| CHILD-002 | 児童新規登録 | 名前、ふりがな、生年月日、学校、学年、アイコン色、支援目標、支援領域タグを登録 | 全ユーザー |
| CHILD-003 | 児童情報編集 | 既存の児童情報を編集。有効/無効の切り替えも可能（論理削除） | 全ユーザー |

### 2.3 日次記録

| ID | 機能 | 説明 | 対象ロール |
|---|---|---|---|
| REC-001 | 本日の記録ダッシュボード | 当日の記録進捗をプログレスバーで表示。未記録/記録済みの児童を分けて表示 | 全ユーザー |
| REC-002 | 日次記録入力 | 児童ごとに来所・退所時刻、気分、活動内容、記録フレーズ、メモ、支援記録まとめ、送迎方法を記録 | 全ユーザー |
| REC-003 | 日次記録編集 | 既存の記録を編集（同日の再アクセスで自動復元） | 全ユーザー |
| REC-004 | 自動遷移 | 記録保存後、次の未記録児童の記録画面へ自動遷移 | 全ユーザー |
| REC-005 | 記録履歴閲覧 | 日付・児童で絞り込んで過去の記録を閲覧 | 全ユーザー |
| REC-006 | 記録削除 | 過去の記録を削除 | 全ユーザー |
| REC-007 | AI支援記録まとめ生成 | 入力情報（気分、活動、フレーズ、メモ、児童基本情報）をもとにClaude Sonnet 4.5 APIで支援記録文章を自動生成。直接手入力も可能 | 全ユーザー |

### 2.4 フレーズバンク

| ID | 機能 | 説明 | 対象ロール |
|---|---|---|---|
| PHR-001 | フレーズ一覧表示 | デフォルト・カスタムフレーズをカテゴリ別に表示 | 全ユーザー |
| PHR-002 | カスタムフレーズ追加 | カテゴリ、テキスト、支援領域タグ、表示順を指定してフレーズを追加 | 全ユーザー |
| PHR-003 | カスタムフレーズ編集 | 既存のカスタムフレーズを編集（デフォルトフレーズは編集不可） | 全ユーザー |
| PHR-004 | フレーズ優先表示 | 記録画面で児童の支援領域タグに合致するフレーズをハイライト表示 | 全ユーザー |

### 2.5 帳票出力

| ID | 機能 | 説明 | 対象ロール |
|---|---|---|---|
| DOC-001 | 業務日誌 | 指定日の全児童の記録を一覧表形式で印刷/PDF出力。表示項目：児童名、来所・退所時刻、活動内容、支援記録まとめ、送迎、記録者。署名欄付き | 全ユーザー |
| DOC-002 | サービス提供記録 | 指定日・指定児童の個別記録を帳票形式で印刷/PDF出力。保護者確認欄・管理者署名欄付き | 全ユーザー |
| DOC-003 | 月間出席サマリー | 指定月の全児童の出席状況をカレンダー形式で表示・印刷 | 全ユーザー |

### 2.6 Admin管理画面（スーパー管理者向け）

| ID | 機能 | 説明 | 対象ロール |
|---|---|---|---|
| ADM-001 | Admin ログイン | パスワード認証による管理画面へのアクセス | スーパー管理者 |
| ADM-002 | ダッシュボード | 全施設の統計情報（施設数、ユーザー数、記録数）を表示 | スーパー管理者 |
| ADM-003 | 施設一覧・詳細 | 全施設の一覧表示、施設詳細（スタッフ一覧、記録一覧）の閲覧 | スーパー管理者 |
| ADM-004 | 施設編集 | 施設名・プラン・メモ・有効/無効状態の変更 | スーパー管理者 |
| ADM-005 | ユーザー一覧 | 全ユーザーの一覧表示 | スーパー管理者 |

### 2.7 設定

| ID | 機能 | 説明 | 対象ロール |
|---|---|---|---|
| SET-001 | プロフィール編集 | 表示名の変更 | 全ユーザー |
| SET-002 | 施設設定 | 施設名の変更 | admin |
| SET-003 | スタッフ管理 | 施設所属スタッフの一覧表示・ロール変更 | admin |

---

## 3. 非機能要件

### 3.1 パフォーマンス
- 画面遷移：1秒以内（ネットワーク遅延除く）
- データ読み込み：2秒以内
- 同時接続ユーザー数：施設あたり最大20名

### 3.2 可用性
- 稼働率：99.5%以上（Vercel + Supabase SLAに準拠）
- 計画メンテナンス時のダウンタイム通知

### 3.3 セキュリティ
- 通信の暗号化（HTTPS）
- ユーザー認証（メール/パスワード）
- 施設単位のデータ分離（マルチテナント）
- Row Level Security（RLS）によるデータアクセス制御
- セッション管理（Cookie ベース、Supabase SSR）

### 3.4 対応環境
- **ブラウザ**: Chrome, Safari, Edge（最新2バージョン）
- **デバイス**: スマートフォン（主）、タブレット、デスクトップ
- **OS**: iOS 15+, Android 12+, Windows 10+, macOS 12+

### 3.5 アクセシビリティ
- タップターゲット最小44px
- 適切なラベル付け（aria-label）
- 十分なコントラスト比

### 3.6 拡張性
- 新しい活動内容の追加が可能
- フレーズバンクのカスタマイズ
- 帳票テンプレートの追加

---

## 4. ドメイン定義

### 4.1 支援領域タグ
| タグ名 | 説明 |
|---|---|
| 健康・生活 | 基本的な生活習慣、健康管理に関する支援領域 |
| 運動・感覚 | 身体運動、感覚統合に関する支援領域 |
| 認知・行動 | 認知発達、行動調整に関する支援領域 |
| 言語・コミュニケーション | 言語発達、コミュニケーション能力に関する支援領域 |
| 人間関係・社会性 | 対人関係、社会的スキルに関する支援領域 |

### 4.2 活動種別
工作、運動、学習、自由遊び、SST（ソーシャルスキルトレーニング）、おやつ、外出、音楽、調理

### 4.3 気分
- 良好（good / 😊）
- 普通（neutral / 😐）
- 不調（bad / 😢）

### 4.4 送迎方法
送迎車、保護者送迎、自力通所、その他

---

## 5. 制約事項
- インターネット接続が必須（オフライン対応なし）
- 児童の物理削除は行わず、論理削除（is_active フラグ）で対応
- デフォルトフレーズは編集・削除不可
- 1施設あたりの児童数は実運用上100名程度を想定

---

## 6. 用語集
| 用語 | 説明 |
|---|---|
| 放課後等デイサービス | 障害のある子どもに対し、放課後や休日に生活能力向上のための支援を行うサービス |
| 支援記録 | 児童の日々の活動、様子、特記事項を記録した書類 |
| 業務日誌 | 事業所全体の一日の活動記録をまとめた帳票 |
| サービス提供記録 | 個別の児童に対するサービス内容を記録した帳票 |
| フレーズバンク | 記録入力を効率化するための定型文の集合 |
| RLS | Row Level Security。データベースレベルで行単位のアクセス制御を行う仕組み |
| 支援記録まとめ | 本日の支援記録をまとめた文章。手入力またはAIで下書き生成が可能 |
| Admin管理画面 | スーパー管理者用の管理ダッシュボード。全施設の横断管理に使用 |
